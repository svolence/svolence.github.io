<!doctype html>



  


<html class="theme-next mist use-motion" lang="en">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  
    
      
    

    
  

  

  

  
    
      
    

    
  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Monda:300,300italic,400,400italic,700,700italic|Roboto Slab:300,300italic,400,400italic,700,700italic|PT Mono:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0" />






<meta name="description" content="Talk is cheap, show me the code!!!">
<meta property="og:type" content="website">
<meta property="og:title" content="Svolence">
<meta property="og:url" content="https://svolence.github.io/index.html">
<meta property="og:site_name" content="Svolence">
<meta property="og:description" content="Talk is cheap, show me the code!!!">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Svolence">
<meta name="twitter:description" content="Talk is cheap, show me the code!!!">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    sidebar: {"position":"left","display":"hide"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '6342375249689970000',
      author: 'Svolence'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://svolence.github.io/"/>





  <title> Svolence </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  










  
  
    
  

  <div class="container one-collumn sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">Svolence</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle"></p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            Categories
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            About
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            Tags
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="https://svolence.github.io/linux/centos-sendmail/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="Svolence">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Svolence">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="Svolence" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/linux/centos-sendmail/" itemprop="url">
                  centos sendmail
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Posted on</span>
            <!-- <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-11-15T11:25:34+08:00">
              2017-11-15
            </time> -->

            &nbsp;|&nbsp;

            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-check-o"></i>
            </span>
            <time title="Post modified" itemprop="dateModified" datetime="2017-11-15T11:31:15+08:00">
              2017-11-15
            </time>
            
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/sendmail/" itemprop="url" rel="index">
                    <span itemprop="name">sendmail</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/linux/centos-sendmail/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="linux/centos-sendmail/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          
             <span id="/linux/centos-sendmail/" class="leancloud_visitors" data-flag-title="centos sendmail">
               &nbsp; | &nbsp;
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               <span class="post-meta-item-text">Visitors </span>
               <span class="leancloud-visitors-count"></span>
              </span>
          

          
          
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="centos-sendmail配置"><a href="#centos-sendmail配置" class="headerlink" title="centos sendmail配置"></a>centos sendmail配置</h1><h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">yum install -y sendmail</div><div class="line">yum install -y sendmail-cf</div><div class="line"></div><div class="line">[root@vmlin5282 mail]# rpm -qa | grep sendmail</div><div class="line">sendmail-cf-8.14.4-9.el6_8.1.noarch</div><div class="line">sendmail-8.14.4-9.el6_8.1.x86_64</div></pre></td></tr></table></figure>
<h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h3><p>1)<br>备份配置文件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">cp /etc/mail/sendmail.mc /etc/mail/sendmail.mc.bak</div><div class="line"></div><div class="line">cp /etc/mail/sendmail.cf /etc/mail/sendmail.cf.bak</div></pre></td></tr></table></figure></p>
<p>2)<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">vim /etc/mail/sendmail.mc</div></pre></td></tr></table></figure></p>
<p>默认监听本机，这里需要注释掉，添加<code>dnl</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">dnl DAEMON_OPTIONS(`Port=smtp,Addr=127.0.0.1, Name=MTA&apos;)dnl</div></pre></td></tr></table></figure></p>
<blockquote>
<p><code>Sendmail</code>服务的网络访问权限，如果仅仅是本机使用，就不用配置，如果是允许外部机器访问，可以进行限制</p>
<p>将<code>127.0.0.1</code>改为<code>0.0.0.0</code>或者注释掉，意思是任何主机都可以访问<code>Sendmail</code>服务。如果仅让某一个网段能够访问到<code>Sendmail</code>服务，将<code>127.0.0.1</code>改为形如<code>192.168.1.0/24</code>的一个特定网段地址</p>
</blockquote>
<p>3)<br>信息伪装(可选配置，可在PHPMailer中代码中自定义)<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">//此句去掉注释，修改为：MASQUERADE_AS(&apos;yourdomain.com&apos;)dnl</div><div class="line">dnl MASQUERADE_AS(&apos;mydomain.com&apos;)dnl //是否对信息作伪装</div><div class="line"></div><div class="line">//去掉注释</div><div class="line">dnl FEATURE(masquerade_envelope)dnl //是否对整个域（包括子域）做伪装</div><div class="line"></div><div class="line">//去掉注释</div><div class="line">dnl FEATURE(masquerade_entire_domain)dnl</div><div class="line"></div><div class="line">//去掉注释</div><div class="line">dnl MASQUERADE_DOMAIN(localhost)dnl //对localhost域做伪装</div><div class="line"></div><div class="line">//去掉注释</div><div class="line">dnl MASQUERADE_DOMAIN(localhost.localdomain)dnl //将locahost.com域伪装成yourdomain.com</div></pre></td></tr></table></figure></p>
<p>4)<br>开启<code>SMTPAuth</code>认证<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">dnl TRUST_AUTH_MECH(`EXTERNAL DIGEST-MD5 CRAM-MD5 LOGIN PLAIN&apos;)dnl</div><div class="line"></div><div class="line">dnl define(`confAUTH_MECHANISMS&apos;, `EXTERNAL GSSAPI DIGEST-MD5 CRAM-MD5 LOGIN PLAIN&apos;)dnl</div></pre></td></tr></table></figure></p>
<p>将其改为如下<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">TRUST_AUTH_MECH(`EXTERNAL DIGEST-MD5 CRAM-MD5 LOGIN PLAIN&apos;)dnl</div><div class="line"></div><div class="line">define(`confAUTH_MECHANISMS&apos;, `EXTERNAL GSSAPI DIGEST-MD5 CRAM-MD5 LOGIN PLAIN&apos;)dnl</div></pre></td></tr></table></figure></p>
<blockquote>
<p><strong>TRUST_AUTH_MECH</strong>的作用是使<code>sendmail</code>不管<code>access</code>文件中如何设置，都能<code>relay</code>那些通过<code>EXTERNAL</code>, <code>LOGIN</code>, <code>PLAIN</code>, <code>CRAM-MD5</code>或<code>DIGEST-MD5</code>等方式验证的邮件，注意这里是对需要<code>relay</code>的邮件进行验证，只有这样通过验证的邮件才会被<code>relay</code>以防止<code>sendmail</code>服务器被滥用。</p>
<p> <strong>confAUTH_MECHANISMS</strong>的作用是确定系统的认证方式</p>
</blockquote>
<p>5)<br>安全认证<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">[root@vmlin5282 mail]# rpm -qa | grep sasl</div><div class="line">cyrus-sasl-lib-2.1.23-15.el6_6.2.x86_64</div><div class="line">cyrus-sasl-plain-2.1.23-15.el6_6.2.x86_64</div><div class="line">cyrus-sasl-md5-2.1.23-15.el6_6.2.x86_64</div><div class="line">cyrus-sasl-2.1.23-15.el6_6.2.x86_64</div><div class="line">cyrus-sasl-devel-2.1.23-15.el6_6.2.x86_64</div><div class="line">cyrus-sasl-gssapi-2.1.23-15.el6_6.2.x86_64</div><div class="line"></div><div class="line"># yum install</div><div class="line">		cyrus-sasl-gssapi\</div><div class="line">        cyrus-sasl-md5\</div><div class="line">        cyrus-sasl\</div><div class="line">        cyrus-sasl-plain\</div><div class="line">        cyrus-sasl-devel</div></pre></td></tr></table></figure></p>
<p>6)<br><code>m4</code>重新生成<code>sendmail.cf</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">m4 /etc/mail/sendmail.mc &gt; /etc/mail/sendmail.cf</div></pre></td></tr></table></figure></p>
<p>7)<br>重启<code>sendmail、saslauthd</code>服务<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">[root@vmlin5282 mail]# service saslauthd restart</div><div class="line">Stopping saslauthd:                                        [  OK  ]</div><div class="line">Starting saslauthd:                                        [  OK  ]</div><div class="line">[root@vmlin5282 mail]# service sendmail restart</div><div class="line">Shutting down sm-client:                                   [  OK  ]</div><div class="line">Shutting down sendmail:                                    [  OK  ]</div><div class="line">Starting sendmail:                                         [  OK  ]</div><div class="line">Starting sm-client:                                        [  OK  ]</div></pre></td></tr></table></figure></p>
<p>8)<br><code>iptables</code>设置<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"> # vi /etc/sysconfig/iptables</div><div class="line">-A INPUT -p tcp -m state --state NEW -m tcp --dport 25 -j ACCEPT</div></pre></td></tr></table></figure></p>
<p>9)<br>Testing SMTP AUTH<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">[root@vmlin5101 ops]# telnet 10.100.133.248 25</div><div class="line">Trying 10.100.133.248...</div><div class="line">Connected to 10.100.133.248.</div><div class="line">Escape character is &apos;^]&apos;.</div><div class="line">220 mail.xxx.com ESMTP Sendmail 8.14.4/8.14.4; Wed, 15 Nov 2017 10:07:11 +0800</div><div class="line">ehlo laptop</div><div class="line">250-mail.xxx.com Hello [10.100.133.98], pleased to meet you</div><div class="line">250-ENHANCEDSTATUSCODES</div><div class="line">250-PIPELINING</div><div class="line">250-8BITMIME</div><div class="line">250-SIZE</div><div class="line">250-DSN</div><div class="line">250-ETRN</div><div class="line">`50-AUTH GSSAPI DIGEST-MD5 CRAM-MD5 LOGIN PLAIN`</div><div class="line">250-DELIVERBY</div><div class="line">250 HELP</div></pre></td></tr></table></figure></p>
<h3 id="相关配置文件说明"><a href="#相关配置文件说明" class="headerlink" title="相关配置文件说明"></a>相关配置文件说明</h3><ul>
<li><strong><code>/etc/mail/access</code></strong>Allow/Deny other systems to use Sendmail for outbound emails</li>
<li><strong><code>/etc/mail/domaintable</code></strong>AllUsed for domain name mapping for Sendmail</li>
<li><strong><code>/etc/mail/local-host-names</code></strong>Used to define aliases for the host</li>
<li><strong><code>/etc/mail/mailertable</code></strong>Defined the instructions that override routing for particular domains</li>
<li><strong><code>/etc/mail/virtusertable</code></strong>Specifies a domain-specific form of aliasing, allowing multiple virtual domains to be hosted on one machine</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">vim /etc/mail/access</div><div class="line"></div><div class="line"># Check the /usr/share/doc/sendmail/README.cf file for a description</div><div class="line"># of the format of this file. (search for access_db in that file)</div><div class="line"># The /usr/share/doc/sendmail/README.cf is part of the sendmail-doc</div><div class="line"># package.</div><div class="line">#</div><div class="line"># If you want to use AuthInfo with &quot;M:PLAIN LOGIN&quot;, make sure to have the</div><div class="line"># cyrus-sasl-plain package installed.</div><div class="line">#</div><div class="line"># By default we allow relaying from localhost...</div><div class="line">Connect:localhost.localdomain		RELAY</div><div class="line">Connect:localhost			RELAY</div><div class="line">Connect:127.0.0.1			RELAY</div><div class="line">Connect:10.100.133.248			RELAY</div><div class="line">Connect:10.100				RELAY</div><div class="line">Connect:10.96				RELAY</div><div class="line">Connect:*				RELAY</div></pre></td></tr></table></figure>
<p><strong>在实际代码测试过程中未配置hostname aliases</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">vim /etc/mail/local-host-names</div><div class="line"></div><div class="line"># local-host-names - include all aliases for your machine here.</div><div class="line">#mail.xxx.com</div><div class="line">#xxx.com</div><div class="line">#yyyy.com</div></pre></td></tr></table></figure></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="https://svolence.github.io/kong/introduce/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="Svolence">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Svolence">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="Svolence" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/kong/introduce/" itemprop="url">
                  kong introduce
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Posted on</span>
            <!-- <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-06-15T11:35:54+08:00">
              2017-06-15
            </time> -->

            &nbsp;|&nbsp;

            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-check-o"></i>
            </span>
            <time title="Post modified" itemprop="dateModified" datetime="2017-06-15T14:14:09+08:00">
              2017-06-15
            </time>
            
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/kong/" itemprop="url" rel="index">
                    <span itemprop="name">kong</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/kong/introduce/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="kong/introduce/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          
             <span id="/kong/introduce/" class="leancloud_visitors" data-flag-title="kong introduce">
               &nbsp; | &nbsp;
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               <span class="post-meta-item-text">Visitors </span>
               <span class="leancloud-visitors-count"></span>
              </span>
          

          
          
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <h1 id="Kong-初探-一"><a href="#Kong-初探-一" class="headerlink" title="Kong 初探(一)"></a>Kong 初探(一)</h1><h2 id="Kong-安装"><a href="#Kong-安装" class="headerlink" title="Kong 安装"></a>Kong 安装</h2><ul>
<li>可参照<a href="https://getkong.org">官网</a><code>https://getkong.org</code>进行有选择性的安装</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">wget https://github.com/Mashape/kong/releases/download/0.10.3/kong-0.10.3.trusty_all.deb</div><div class="line"></div><div class="line">sudo apt-get update</div><div class="line">sudo apt-get install openssl libpcre3 procps perl</div><div class="line">sudo dpkg -i kong-0.10.3.trusty_all.deb</div></pre></td></tr></table></figure>
<ul>
<li>Kong 支持两种数据库<code>postgres</code> 和 <code>cassandra</code>,默认<code>postgres</code></li>
</ul>
<h2 id="安装postgresql"><a href="#安装postgresql" class="headerlink" title="安装postgresql"></a>安装postgresql</h2><ul>
<li>添加postgresql源：</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">sudo touch /etc/apt/sources.list.d/pgdb.list</div><div class="line">sudo vim /etc/apt/sources.list.d/pgdb.list</div><div class="line"></div><div class="line"># 把下面这行数据添加到pgdb.list文件中：</div><div class="line">deb https://apt.postgresql.org/pub/repos/apt/ trusty-pgdg main</div></pre></td></tr></table></figure>
<ul>
<li>执行下面的命令添加postgresql安装包的秘钥：</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">sudo wget --quiet -O - https://postgresql.org/media/keys/ACCC4CF8.asc | sudo apt-key add - </div><div class="line"></div><div class="line">sudo apt-get update</div><div class="line">sudo apt-get install postgresql-9.6</div><div class="line"></div><div class="line"># 重启 postgresql</div><div class="line">sudo service postgresql restart</div></pre></td></tr></table></figure>
<h2 id="Kong-数据库配置"><a href="#Kong-数据库配置" class="headerlink" title="Kong 数据库配置"></a>Kong 数据库配置</h2><ul>
<li>创建用户、数据库</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">➜  wenyue sudo -i -u postgres          </div><div class="line">postgres@vmlin0310:~$ CREATE USER kong; CREATE DATABASE kong OWNER kong;</div><div class="line">CREATE: command not found</div><div class="line">CREATE: command not found</div><div class="line">postgres@vmlin0310:~$ psql</div><div class="line">psql (9.6.3)</div><div class="line">Type &quot;help&quot; for help.</div><div class="line"></div><div class="line">postgres=# CREATE USER kong; CREATE DATABASE kong OWNER kong;</div><div class="line">CREATE ROLE</div><div class="line">CREATE DATABASE</div><div class="line">postgres=#</div></pre></td></tr></table></figure>
<ul>
<li>修改密码</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">➜  wenyue sudo su postgres</div><div class="line">postgres@vmlin0310:/home/wenyue$ psql</div><div class="line">psql (9.6.3)</div><div class="line">Type &quot;help&quot; for help.</div><div class="line"></div><div class="line">postgres=# \password kong</div><div class="line">Enter new password: </div><div class="line">Enter it again: </div><div class="line">postgres=# exit</div><div class="line">postgres-# \q</div><div class="line">postgres@vmlin0310:/home/wenyue$ exit</div><div class="line">exit</div></pre></td></tr></table></figure>
<ul>
<li>验证</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">➜  wenyue psql -U kong -d kong -h 127.0.0.1</div><div class="line">Password for user kong: </div><div class="line">psql (9.6.3)</div><div class="line">SSL connection (protocol: TLSv1.2, cipher: ECDHE-RSA-AES256-GCM-SHA384, bits: 256, compression: off)</div><div class="line">Type &quot;help&quot; for help.</div><div class="line"></div><div class="line">kong=&gt; \l</div><div class="line">                                  List of databases</div><div class="line">   Name    |  Owner   | Encoding |   Collate   |    Ctype    |   Access privileges   </div><div class="line">-----------+----------+----------+-------------+-------------+-----------------------</div><div class="line"> kong      | kong     | UTF8     | en_US.UTF-8 | en_US.UTF-8 | </div><div class="line"> postgres  | postgres | UTF8     | en_US.UTF-8 | en_US.UTF-8 | </div><div class="line"> template0 | postgres | UTF8     | en_US.UTF-8 | en_US.UTF-8 | =c/postgres          +</div><div class="line">           |          |          |             |             | postgres=CTc/postgres</div><div class="line"> template1 | postgres | UTF8     | en_US.UTF-8 | en_US.UTF-8 | =c/postgres          +</div><div class="line">           |          |          |             |             | postgres=CTc/postgres</div><div class="line">(4 rows)</div><div class="line"></div><div class="line">kong=&gt;</div></pre></td></tr></table></figure>
          <!--noindex-->
          <div class="post-more-link text-center">
            <a class="btn" href="/kong/introduce/#more" rel="contents">
              Read more &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="https://svolence.github.io/gitlab/PostgreSQL-Migration-MySQL/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="Svolence">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Svolence">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="Svolence" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/gitlab/PostgreSQL-Migration-MySQL/" itemprop="url">
                  Gitlab PostgreSQL Migration MySQL
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Posted on</span>
            <!-- <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-03-02T18:59:04+08:00">
              2017-03-02
            </time> -->

            &nbsp;|&nbsp;

            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-check-o"></i>
            </span>
            <time title="Post modified" itemprop="dateModified" datetime="2017-03-03T08:36:34+08:00">
              2017-03-03
            </time>
            
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/gitlab/" itemprop="url" rel="index">
                    <span itemprop="name">gitlab</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/gitlab/PostgreSQL-Migration-MySQL/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="gitlab/PostgreSQL-Migration-MySQL/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          
             <span id="/gitlab/PostgreSQL-Migration-MySQL/" class="leancloud_visitors" data-flag-title="Gitlab PostgreSQL Migration MySQL">
               &nbsp; | &nbsp;
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               <span class="post-meta-item-text">Visitors </span>
               <span class="leancloud-visitors-count"></span>
              </span>
          

          
          
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <h1 id="Gitlab-PostgreSQL-Migration-MySQL"><a href="#Gitlab-PostgreSQL-Migration-MySQL" class="headerlink" title="Gitlab PostgreSQL Migration MySQL"></a>Gitlab PostgreSQL Migration MySQL</h1><hr>
<h1 id="1-Packages-Dependencies"><a href="#1-Packages-Dependencies" class="headerlink" title="1. Packages / Dependencies"></a>1. Packages / Dependencies</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">sudo apt-get update</div><div class="line">sudo apt-get upgrade</div></pre></td></tr></table></figure>
<blockquote>
<p>During this installation some files will need to be edited manually. If you are familiar with vim set it as default editor with the commands below. If you are not familiar with vim please skip this and keep using the default editor.</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"># Install vim and set as default editor</div><div class="line">sudo apt-get install vim</div><div class="line">sudo update-alternatives --set editor /usr/bin/vim.basic</div></pre></td></tr></table></figure>
<p>Install the required packages (needed to compile Ruby and native extensions to Ruby gems):<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo apt-get install build-essential zlib1g-dev libyaml-dev libssl-dev libgdbm-dev libreadline-dev libncurses5-dev libffi-dev curl openssh-server checkinstall libxml2-dev libxslt-dev libcurl4-openssl-dev libicu-dev logrotate python-docutils pkg-config cmake</div></pre></td></tr></table></figure></p>
<p>Make sure you have the right version of Git installed<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"># Install Git</div><div class="line">sudo apt-get install  git</div><div class="line"></div><div class="line"># Make sure Git is version 2.8.4 or higher</div><div class="line">git --version</div></pre></td></tr></table></figure></p>
<blockquote>
<p>In order to receive mail notifications, make sure to install a mail server. By default, Debian is shipped with exim4 but this has problems while Ubuntu does not ship with one. The recommended mail server is postfix and you can install it with</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo apt-get install postfix</div></pre></td></tr></table></figure>
<p>Then select ‘Internet Site’ and press enter to confirm the hostname</p>
<h1 id="2-Ruby"><a href="#2-Ruby" class="headerlink" title="2. Ruby"></a>2. Ruby</h1><blockquote>
<p>The current supported Ruby versions are 2.1.x and 2.3.x. 2.3.x is preferred, and support for 2.1.x will be dropped in the future.</p>
<p>The use of Ruby version managers such as RVM, rbenv or chruby with GitLab in production, frequently leads to hard to diagnose problems. For example, GitLab Shell is called from OpenSSH, and having a version manager can prevent pushing and pulling over SSH. Version managers are not supported and we strongly advise everyone to follow the instructions below to use a system Ruby.</p>
</blockquote>
<p>Remove the old Ruby 1.8 if present:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo apt-get remove ruby1.8</div></pre></td></tr></table></figure></p>
<p>Download Ruby and compile it:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">mkdir /tmp/ruby &amp;&amp; cd /tmp/ruby</div><div class="line">curl --remote-name --progress https://cache.ruby-lang.org/pub/ruby/x.x.x/ruby-x.x.x.tar.gz</div><div class="line">tar xzf ruby-x.x.x.tar.gz</div><div class="line">cd ruby-x.x.x</div><div class="line">./configure --disable-install-rdoc</div><div class="line">make</div><div class="line">sudo make install</div></pre></td></tr></table></figure></p>
<p>Install the Bundler Gem:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo gem install bundler --no-ri --no-rdoc</div></pre></td></tr></table></figure></p>
<h1 id="3-Go"><a href="#3-Go" class="headerlink" title="3. Go"></a>3. Go</h1><blockquote>
<p>Since GitLab 8.0, Git HTTP requests are handled by gitlab-workhorse (formerly gitlab-git-http-server). This is a small daemon written in Go. To install gitlab-workhorse we need a Go compiler. The instructions below assume you use 64-bit Linux. You can find downloads for other platforms at the Go download page.</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"># Remove former Go installation folder</div><div class="line">sudo rm -rf /usr/local/go</div><div class="line"></div><div class="line">curl --remote-name --progress https://storage.googleapis.com/golang/go1.x.x.linux-amd64.tar.gz</div><div class="line">sudo tar -C /usr/local -xzf go1.x.x.linux-amd64.tar.gz</div><div class="line">sudo ln -sf /usr/local/go/bin/&#123;go,godoc,gofmt&#125; /usr/local/bin/</div><div class="line"></div><div class="line">rm go1.x.3.linux-amd64.tar.gz</div></pre></td></tr></table></figure>
          <!--noindex-->
          <div class="post-more-link text-center">
            <a class="btn" href="/gitlab/PostgreSQL-Migration-MySQL/#more" rel="contents">
              Read more &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="https://svolence.github.io/influxdb/Telegraf-Influxdb-Grafana(2)/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="Svolence">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Svolence">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="Svolence" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/influxdb/Telegraf-Influxdb-Grafana(2)/" itemprop="url">
                  Telegraf+Influxdb+Grafana (2)
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Posted on</span>
            <!-- <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-12-09T17:01:55+08:00">
              2016-12-09
            </time> -->

            &nbsp;|&nbsp;

            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-check-o"></i>
            </span>
            <time title="Post modified" itemprop="dateModified" datetime="2016-12-09T17:01:48+08:00">
              2016-12-09
            </time>
            
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/influxdb/" itemprop="url" rel="index">
                    <span itemprop="name">influxdb</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/influxdb/Telegraf-Influxdb-Grafana(2)/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="influxdb/Telegraf-Influxdb-Grafana(2)/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          
             <span id="/influxdb/Telegraf-Influxdb-Grafana(2)/" class="leancloud_visitors" data-flag-title="Telegraf+Influxdb+Grafana (2)">
               &nbsp; | &nbsp;
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               <span class="post-meta-item-text">Visitors </span>
               <span class="leancloud-visitors-count"></span>
              </span>
          

          
          
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="datasource-amp-dashboards-config"><a href="#datasource-amp-dashboards-config" class="headerlink" title="datasource &amp; dashboards config"></a>datasource &amp; dashboards config</h1><ul>
<li>访问<a href="http://localhost:3000" target="_blank" rel="external">http://localhost:3000</a> <code>Grafana</code>控制面板</li>
</ul>
<p><img src="/images/grafana/01.png" alt="初始化界面"></p>
<ul>
<li><p>确保已经添加数据源（可以通过上一节中<code>Telegraf</code>采集本机数据入<code>influxdb</code>）</p>
<p>  点击左上角<code>Grafana</code>图标-&gt;<code>Data Sources</code>如下：</p>
<p>  <img src="/images/grafana/10.png" alt="add datasource"></p>
<p>  <img src="/images/grafana/11.png" alt="add datasource"></p>
<p>  <img src="/images/grafana/12.png" alt="edit datasource"></p>
</li>
<li><p>点击图中位置１可以新建一个dashboard</p>
</li>
</ul>
<p><img src="/images/grafana/13.png" alt="add databoards"></p>
<p>或者导入一个<code>json</code>格式的文件</p>
<p><img src="/images/grafana/14.png" alt="edit databoards"></p>
<ul>
<li>下图是我本机的数据，通过位置３可以添加选项，位置４编辑dashborad，位置5添加Row</li>
</ul>
<p><img src="/images/grafana/02.png" alt="edit databoards"></p>
<ul>
<li>选择数据库，添加查询语句</li>
</ul>
<p><img src="/images/grafana/03.png" alt="add sql"></p>
<ul>
<li>Alert config</li>
</ul>
<p><img src="/images/grafana/04.png" alt="alert config"></p>
<ul>
<li>add email</li>
</ul>
<p><img src="/images/grafana/05.png" alt="add email"></p>
<ul>
<li>config notifications</li>
</ul>
<p><img src="/images/grafana/06.png" alt="config"></p>
<p><img src="/images/grafana/07.png" alt="config"></p>
<p><img src="/images/grafana/08.png" alt="config"></p>
<h1 id="TroubleShooting"><a href="#TroubleShooting" class="headerlink" title="TroubleShooting"></a>TroubleShooting</h1><p>测试邮件发送的时候未接受到邮件，查看日志<code>tail -f /var/log/grafana</code>发现：</p>
<blockquote>
<p>t=2016-12-08T11:26:21+0800 lvl=eror msg=”Failed to send alert notification</p>
<p>email” logger=alerting.notifier.email error=”Grafana mailing/smtp options not configured, contact your Grafana admin”</p>
<p>t=2016-12-08T14:05:50+0800 lvl=eror msg=”Failed to send alert notification</p>
<p>email” logger=alerting.notifier.email error=”gomail: could not send email 1: 503 Error: need EHLO and AUTH first !”</p>
</blockquote>
<p>需要开启smtp以及正确配置<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># vi /etc/grafana/grafana.ini</span></div><div class="line"></div><div class="line">[smtp]</div><div class="line">enabled = <span class="literal">true</span></div><div class="line">;host = localhost:25</div><div class="line">user = 系统邮箱账户(admin@qq.com)</div><div class="line">password = 系统邮箱密码(admin)</div><div class="line">host = smtp.exmail.qq.com:465 </div><div class="line">//因为我在本地vbox虚拟机中测试的，所以这里用的是腾讯企业邮箱的服务器，对应上面的user和pass就是我自己的邮箱和密码</div><div class="line">;cert_file =</div><div class="line">;key_file =</div><div class="line">;skip_verify = <span class="literal">false</span></div><div class="line">from_address = admin@qq.com</div></pre></td></tr></table></figure></p>
<h1 id="收到的邮件类似这样"><a href="#收到的邮件类似这样" class="headerlink" title="收到的邮件类似这样"></a>收到的邮件类似这样</h1><p><img src="/images/grafana/15.png" alt="success"></p>
<p>参考链接:</p>
<ul>
<li><a href="http://docs.grafana.org/" target="_blank" rel="external">http://docs.grafana.org/</a></li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="https://svolence.github.io/influxdb/Telegraf-Influxdb-Grafana(1)/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="Svolence">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Svolence">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="Svolence" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/influxdb/Telegraf-Influxdb-Grafana(1)/" itemprop="url">
                  Telegraf+Influxdb+Grafana (1)
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Posted on</span>
            <!-- <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-12-08T21:30:04+08:00">
              2016-12-08
            </time> -->

            &nbsp;|&nbsp;

            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-check-o"></i>
            </span>
            <time title="Post modified" itemprop="dateModified" datetime="2016-12-09T15:51:23+08:00">
              2016-12-09
            </time>
            
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/influxdb/" itemprop="url" rel="index">
                    <span itemprop="name">influxdb</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/influxdb/Telegraf-Influxdb-Grafana(1)/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="influxdb/Telegraf-Influxdb-Grafana(1)/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          
             <span id="/influxdb/Telegraf-Influxdb-Grafana(1)/" class="leancloud_visitors" data-flag-title="Telegraf+Influxdb+Grafana (1)">
               &nbsp; | &nbsp;
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               <span class="post-meta-item-text">Visitors </span>
               <span class="leancloud-visitors-count"></span>
              </span>
          

          
          
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Telegraf-InfluxDB-Grafana初探"><a href="#Telegraf-InfluxDB-Grafana初探" class="headerlink" title="Telegraf+InfluxDB+Grafana初探"></a>Telegraf+InfluxDB+Grafana初探</h1><h2 id="1-Configuration-information"><a href="#1-Configuration-information" class="headerlink" title="1.Configuration information"></a>1.Configuration information</h2><ul>
<li><p><code>system info</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">unbuntu 16.04 x86_64</div></pre></td></tr></table></figure>
</li>
<li><p><code>InfluxDB v1.1.1 install</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">wget https://dl.influxdata.com/influxdb/releases/influxdb_1.1.1_amd64.deb</div><div class="line">sudo dpkg -i influxdb_1.1.1_amd64.deb</div></pre></td></tr></table></figure>
</li>
<li><p><code>Telegraf v1.1.1 install</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">wget https://dl.influxdata.com/telegraf/releases/telegraf_1.1.1_amd64.deb</div><div class="line">sudo dpkg -i telegraf_1.1.1_amd64.deb</div></pre></td></tr></table></figure>
</li>
<li><p><code>Chronograf v1.1.0~beta1 install</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">wget https://dl.influxdata.com/chronograf/releases/chronograf_1.1.0~beta1_amd64.deb</div><div class="line">sudo dpkg -i chronograf_1.1.0~beta1_amd64.deb</div></pre></td></tr></table></figure>
</li>
<li><p><code>Kapacitor v1.1.1 install</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">wget https://dl.influxdata.com/kapacitor/releases/kapacitor_1.1.1_amd64.deb</div><div class="line">sudo dpkg -i kapacitor_1.1.1_amd64.deb</div></pre></td></tr></table></figure>
</li>
<li><p><code>grafana_4.0.1 install</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">wget https://grafanarel.s3.amazonaws.com/builds/grafana_4.0.1-1480694114_amd64.deb</div><div class="line">sudo apt-get install -y adduser libfontconfig</div><div class="line">sudo dpkg -i grafana_4.0.1-1480694114_amd64.deb</div></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="2-Telegraf-抓取本机信息"><a href="#2-Telegraf-抓取本机信息" class="headerlink" title="2.Telegraf 抓取本机信息"></a>2.Telegraf 抓取本机信息</h2><ul>
<li>自动生成telegraf.conf<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">telegraf config &gt; telegraf.conf</div></pre></td></tr></table></figure>
</li>
</ul>
<blockquote>
<p>Note: Telegraf will start automatically using the default configuration when installed from a deb package.</p>
</blockquote>
<p><strong>通过deb安装的话，Telegraf默认启动的配置文件在<code>/etc/telegraf/telegraf.conf</code></strong></p>
<p>手动生成一个简单的配置<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">telegraf -sample-config -input-filter cpu:mem -output-filter influxdb &gt; telegraf.conf</div><div class="line"></div><div class="line">root@<span class="built_in">test</span>:/etc/telegraf<span class="comment"># cat test.conf </span></div><div class="line">[agent]</div><div class="line">    interval = <span class="string">"1s"</span></div><div class="line"></div><div class="line">[outputs]</div><div class="line"></div><div class="line"><span class="comment"># Configuration to send data to InfluxDB.</span></div><div class="line">[outputs.influxdb]</div><div class="line">    urls = [<span class="string">"http://localhost:8086"</span>]</div><div class="line">    database = <span class="string">"kapacitor_example"</span></div><div class="line">    user_agent = <span class="string">"telegraf"</span></div><div class="line"></div><div class="line"><span class="comment"># Collect metrics about cpu usage</span></div><div class="line">[cpu]</div><div class="line">    percpu = <span class="literal">false</span></div><div class="line">    totalcpu = <span class="literal">true</span></div><div class="line">    drop = [<span class="string">"cpu_time"</span>]</div><div class="line"></div><div class="line">root@<span class="built_in">test</span>:/etc/telegraf<span class="comment">#</span></div></pre></td></tr></table></figure></p>
<p>InfluxDB中查看抓取信息</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line">root@<span class="built_in">test</span>:/etc/telegraf<span class="comment"># influx</span></div><div class="line">Visit https://enterprise.influxdata.com to register <span class="keyword">for</span> updates, InfluxDB server management, and monitoring.</div><div class="line">Connected to http://localhost:8086 version 1.1.0</div><div class="line">InfluxDB shell version: 1.1.0</div><div class="line">&gt; show databases;</div><div class="line">name: databases</div><div class="line">name</div><div class="line">----</div><div class="line">telegraf</div><div class="line">_internal</div><div class="line">kapacitor_example</div><div class="line">test_log</div><div class="line">error_log</div><div class="line"></div><div class="line">&gt; use telegraf</div><div class="line">Using database telegraf</div><div class="line">&gt; show measurements;</div><div class="line">name: measurements</div><div class="line">name</div><div class="line">----</div><div class="line">cpu</div><div class="line">disk</div><div class="line">diskio</div><div class="line">kernel</div><div class="line">mem</div><div class="line">processes</div><div class="line">swap</div><div class="line">system</div><div class="line">&gt;</div></pre></td></tr></table></figure>
<blockquote>
<p>To enable the Admin UI, edit the configuration file to set enabled = true in the [admin] section.<br>You must restart the process for any configuration changes to take effect. </p>
<p>Once enabled, the Admin UI is available by default at port 8083, i.e. <a href="http://localhost:8083" target="_blank" rel="external">http://localhost:8083</a>.<br>You can control the port in the InfluxDB config file using the port option in the [admin] section.</p>
</blockquote>
<p>InfluxDB v1.1之前默认开启后台管理界面，直接访问：<code>http://localhost:8083</code>，新的版本默认关闭，开启的话需要在<br><code>/etc/influxdb/influxdb.conf</code>下[admin]选项下开启</p>
<h2 id="3-Chronograf-可视化展示"><a href="#3-Chronograf-可视化展示" class="headerlink" title="3.Chronograf 可视化展示"></a>3.Chronograf 可视化展示</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">influxd <span class="comment"># 启动influxdb</span></div></pre></td></tr></table></figure>
<p>访问<a href="http://localhost:10000" target="_blank" rel="external">http://localhost:10000</a>,会看到如下界面<br><img src="/images/chronograf-view.png" alt="可视化界面"></p>
<p>参考链接:</p>
<ul>
<li><a href="https://docs.influxdata.com/" target="_blank" rel="external">https://docs.influxdata.com/</a></li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.gif"
               alt="Svolence" />
          <p class="site-author-name" itemprop="name">Svolence</p>
          <p class="site-description motion-element" itemprop="description">Talk is cheap, show me the code!!!</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">15</span>
              <span class="site-state-item-name">posts</span>
            </a>
          </div>

          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">9</span>
                <span class="site-state-item-name">categories</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">16</span>
                <span class="site-state-item-name">tags</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        


      </section>

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Svolence</span>
</div>


<div class="powered-by">
  Powered by <a class="theme-link" href="https://hexo.io">Hexo</a>
</div>

<div class="theme-info">
  Theme -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>


        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"svolence"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  
    
    
    <script src="/lib/ua-parser-js/dist/ua-parser.min.js?v=0.7.9"></script>
    <script src="/js/src/hook-duoshuo.js"></script>
  








  
  

  

  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.1.js"></script>
  <script>AV.initialize("gg4V2cN69UAJQ53rO4JwVmaL-gzGzoHsz", "uYSk8wzlMAMgisyaGCA2yWFq");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  

  


</body>
</html>
